input {
	file {
		path => "/opt/jetty/logs/jetty.log"
		codec => "json"
		type => "server_logs"
	}
	file {
		path => "<%= node['mars']['app_logs'] %>"
		codec => "json"
		type => "application_logs"
	}
	file {
		path => "/opt/jetty/logs/logback-access.log"
		codec => "json"
		type => "access_logs"
	}
}

filter {
	if [type] == "access_logs" {
		mutate {
			convert => [ "@fields.status_code", "string" ]
			add_field => { "environmentName" => "<%= node['war']['environment'] %>" }
		}
	}
}

output {
	if [type] != "access_logs" or [@fields.status_code] =~ /^[45]\d\d/ {
		sqs {
			queue => "logstash"
			region => "us-east-1"
			use_ssl => false
			codec => json
		}
	}
}
